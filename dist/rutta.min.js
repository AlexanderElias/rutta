/*
	@preserve
	title: rutta
	version: 1.0.4
	author: alexander elias
*/
(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?module.exports=b():'function'==typeof define&&define.amd?define('Rutta',b):a.Rutta=b()})(this,function(){'use strict';function b(z){return decodeURI(z).replace(document.location.origin,'').replace(/(^\/?#?\/)/,'').replace(/(\/$)/,'')}function h(z){this.route=z.route,this.state=z.state}function j(z){var A='';for(var B in z)A=0<A.length?A+'&':A,A=A+encodeURIComponent(B)+'='+encodeURIComponent(z[B]);return A}function m(z){this.query=z.query,this.route=z.route}function n(z){this.name=z.name,this.routes=z.routes||[],this.redirects=z.redirects||[],this.query=z.query||'[r-view="'+this.name+'"]',this.isListening=!1,this.permitChangeEvent=!0,this.state=z.state||{},this.location=document.location,this.mode=null===z.mode||z.mode===void 0?x:z.mode,this.root=null===z.root||z.root===void 0?this.mode?'/':'#/':z.root}var o={has:function(z,A){return-1!==z.indexOf(A)},clean:b,strip:function(z){return b(z).replace(/(\?.*?$)|(#.*?$)/g,'')},getSearch:function(z){return b(z).split('?')[1]||''},getHash:function(z){return b(z).split('?')[0].split('#')[1]||''},getPathname:function(z){return b(z).split('?')[0].split('#')[0]||''}},p={html:function(z){z=z||{},document.title=z.title||'',document.querySelector(z.query).innerHTML=z.content||''},text:function(z){z=z||{},document.title=z.title||'',document.querySelector(z.query).innerText=z.content||''}},q=function(z){return new h(z)},r={script:'text/javascript, application/javascript, application/x-javascript',json:'application/json, text/javascript',xml:'application/xml, text/xml',html:'text/html',text:'text/plain',urlencoded:'application/x-www-form-urlencoded'},t={mime:r,request:function(z){if(!z)throw new Error('Axa: requires options');if(!z.action)throw new Error('Axa: requires options.action');if(z.method||(z.method='GET'),z.headers||(z.headers={}),z.data)if('GET'===z.method)z.action=z.action+'?'+j(z.data),z.data=null;else{switch(z.requestType=z.requestType.toLowerCase(),z.responseType=z.responseType.toLowerCase(),z.requestType){case'script':z.contentType=r.script;break;case'json':z.contentType=r.json;break;case'xml':z.contentType=r.xm;break;case'html':z.contentType=r.html;break;case'text':z.contentType=r.text;break;default:z.contentType=r.urlencoded;}switch(z.responseType){case'script':z.accept=r.script;break;case'json':z.accept=r.json;break;case'xml':z.accept=r.xml;break;case'html':z.accept=r.html;break;case'text':z.accept=r.text;}z.contentType===r.json&&(z.data=JSON.stringify(z.data)),z.contentType===r.urlencoded&&(z.data=j(z.data))}var A=new XMLHttpRequest;if(A.open(z.method.toUpperCase(),z.action,!0,z.username,z.password),z.mimeType&&A.overrideMimeType(z.mimeType),z.withCredentials&&(A.withCredentials=z.withCredentials),z.accept&&(z.headers.Accept=z.accept),z.contentType&&(z.headers['Content-Type']=z.contentType),z.headers)for(var B in z.headers)A.setRequestHeader(B,z.headers[B]);A.onreadystatechange=function(){if(4===A.readyState)return 200<=A.status&&400>A.status?z.success(A):z.error(A)},A.send(z.data)},serialize:j};m.prototype.content=function(z){var A=this;p.html({query:A.query,title:A.route.title,content:z})},m.prototype.file=function(z,A){var B=this;t.request({action:z,responseType:'html',success:function(C){if(p.html({query:B.query,title:B.route.title,content:C.response}),A)return A()},error:function(C){if(p.text({query:B.query,title:B.route.title,content:C.response}),A)return A()}})},m.prototype.redirect=function(z){window.location=z};var u=function(z){return new m(z)},v=2,w=3,x='history'in window&&'pushState'in window.history;n.prototype.isSameOrigin=function(z){return z&&-1<z.indexOf(document.location.origin)},n.prototype.isSamePath=function(z,A){return o.clean(z||'')===o.clean(A||'')},n.prototype.add=function(z){var A=this;return'Object'===z.constructor.name?A.routes.push(z):'Array'===z.constructor.name&&(A.routes=A.routes.concat(z)),A},n.prototype.remove=function(z){for(var D,A=this,B=0,C=A.routes.length;B<C;B++)if(D=A.routes[B],z===D.path){A.routes.splice(B,1);break}return A},n.prototype.get=function(z){var A=this,B=A.routes.length,C=null,D=0;for(z=o.strip(z),D;D<B;D++)if(C=A.routes[D],'string'==typeof C.path){if(C.path===z||C.path==='/'+z)return C;}else if(C.path.test(z))return C},n.prototype.navigate=function(z,A){var B=this,C=B.get(z.path);if(B.state.title=C&&C.title?C.title:z.title,B.state.path=B.mode?B.root+o.clean(z.path):B.root+o.clean(z.path),B.mode?(A===v&&window.history.pushState(B.state,B.state.title,B.state.path),A===w&&window.history.replaceState(B.state,B.state.title,B.state.path)):(B.permitChangeEvent=!1,window.location.hash=B.state.path),C){var D={route:C,state:this.state,query:this.query,href:document.location.href,hash:o.getHash(this.href),search:o.getSearch(this.href),pathname:o.getPathname(this.href)};C.handler(q(D),u(D))}else p.text({query:this.query});return B},n.prototype.listen=function(){var z=this;return z.isListening?z:(z.isListening=!0,window.addEventListener('DOMContentLoaded',function(){var A={title:document.title,path:document.location.href};z.navigate(A,w)},!1),window.addEventListener(z.mode?'popstate':'hashchange',function(A){if(z.permitChangeEvent){var B={};B=z.mode?A.state||{}:{path:A.newURL},z.navigate(B)}else z.permitChangeEvent=!0},!1),window.addEventListener('click',function(A){if(!(A.metaKey||A.ctrlKey||A.shiftKey)){for(var B=A.path?A.path[0]:A.target;B&&'A'!==B.nodeName;)B=B.parentNode;if(B&&'A'===B.nodeName&&!(B.hasAttribute('download')||'external'===B.getAttribute('rel'))){var C={path:B.href||'',title:B.title||''};o.has(C.path,'mailto:')||o.has(C.path,'tel:')||o.has(C.path,'file:')||o.has(C.path,'ftp:')||z.isSameOrigin(C.path)&&(A.preventDefault(),z.isSamePath(C.path,z.state.path)||z.navigate(C,v))}}},!1),z)};return{routers:{},router:function(z){if(!z.name)throw new Error('Router - name parameter required');if(this.routers[z.name])throw new Error('Router - name '+z.name+' exists');return this.routers[z.name]=new n(z),this.routers[z.name]}}});